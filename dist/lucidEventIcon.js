!function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=2)}([function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();e.exports=function(){function e(){n(this,e)}return i(e,[{key:"getAllEventIcons",value:function(){var e=[];return $gameMap._events.forEach(function(t){if(void 0!==t)for(var n=t.page().list.length,i=0;i<n;i++)if(108===t.page().list[i].code){var o=t.page().list[i].parameters[0].match(/<eventIcon: (.*)>/i);o&&e.push({event_id:t._eventId,icon_id:Number(o[1])})}}),e}},{key:"getEventIcon",value:function(e){for(var t=$gameMap.event(e),n=t.page().list.length,i=0;i<n;i++){if(108===t.page().list[i].code){var o=t.page().list[i].parameters[0].match(/<eventIcon: (.*)>/i);return o?{event_id:t._eventId,icon_id:Number(o[1])}:{event_id:t._eventId,icon_id:0}}return{event_id:t._eventId,icon_id:0}}}}]),e}()},function(e,t,n){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),c=function e(t,n,i){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,n,i)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(i)},s=n(0);e.exports=function(e){function t(e,n){i(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.eventIconDetails=n,r.mapEventsIcons=e,r}return r(t,e),a(t,[{key:"initialize",value:function(){c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this),$gamePlayer.actionIconTarget=$gamePlayer.actionIconTarget||{event_id:0,icon_id:0},this._iconIndex=0,this.z=100,this.changeBitmap($gamePlayer.actionIconTarget),this._tileWidth=$gameMap.tileWidth(),this._tileHeight=$gameMap.tileHeight(),this._offsetX=-Window_Base._iconWidth/2,this._offsetY=-38,this.anchor.y=1,this._float=.1,this.mod=.2,this.mapEventsIcons=new s,lucidScripts.lucidEventIcon.needRefresh=!0}},{key:"changeBitmap",value:function(e){if(e.event_id<=0?this._iconIndex=0:this._iconIndex=e.icon_id,!(this._iconIndex<=0)){var t=Window_Base._iconWidth,n=Window_Base._iconHeight,i=this._iconIndex%16*t,o=Math.floor(this._iconIndex/16)*n,r=ImageManager.loadSystem("IconSet");this.bitmap=new Bitmap(t,n),this.bitmap.blt(r,i,o,t,n,0,0),this.scale.y=.1,this.opacity=0,this.mod=.2,this._float=.1,lucidScripts.lucidEventIcon.needRefresh=!1}}},{key:"updateOpacity",value:function(){$gameMap.isEventRunning()&&$gameMap._interpreter.eventId()===this.eventIconDetails.event_id?this.opacity-=40:this.opacity=255}},{key:"update",value:function(){c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"update",this).call(this),$gameMap.requestRefresh(),lucidScripts.lucidEventIcon.needRefresh&&void 0!==this.eventIconDetails&&($gamePlayer.actionIconTarget=this.eventIconDetails,$gamePlayer.actionIconTarget=this.mapEventsIcons.getEventIcon($gamePlayer.actionIconTarget.event_id)),this._iconIndex!==$gamePlayer.actionIconTarget.icon_id&&this.changeBitmap($gamePlayer.actionIconTarget),this._iconIndex<=0||(this.x=$gameMap.event($gamePlayer.actionIconTarget.event_id).screenX()+this._offsetX,this.y=$gameMap.event($gamePlayer.actionIconTarget.event_id).screenY()+this._offsetY+this._float,this.scale.y=Math.min(this.scale.y+.1,1),this.updateOpacity(),this._float+=this.mod,this._float<-.1?this.mod=Math.min(this.mod+.01,.2):this._float>=.1&&(this.mod=Math.max(this.mod+-.01,-.2)))}}]),t}(Sprite)},function(e,t,n){var i=n(1),o=n(0);window.lucidScripts=window.lucidScripts||{},lucidScripts.lucidEventIcon={needRefresh:!1,recreateMapIcons:!1},function(){var e=Game_System.prototype.initialize;Game_System.prototype.initialize=function(){e.call(this),lucidScripts.lucidEventIcon.needRefresh=!0};var t=Game_Map.prototype.requestRefresh;Game_Map.prototype.requestRefresh=function(e){t.call(this,e),lucidScripts.lucidEventIcon.needRefresh=!0};var n=Spriteset_Map.prototype.createLowerLayer;Spriteset_Map.prototype.createLowerLayer=function(){n.call(this),this.createActionIconSprite()},Spriteset_Map.prototype.createActionIconSprite=function(){var e=new o;e.getAllEventIcons().forEach(function(t){this["_eventiconSprite_"+t.event_id]=new i(e,t),this._tilemap.addChild(this["_eventiconSprite_"+t.event_id])},this)}}()}]);